<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>팀 통합 주간보고 결과</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<div th:replace="~{fragments/nav :: nav}"></div>

<div class="page-wrapper">
    <div class="page-card">
        <!-- Header -->
        <div class="detail-header">
            <span class="detail-avatar" style="background: linear-gradient(135deg, #805ad5, #6b46c1);">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24">
                    <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4-4v2"/><circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/>
                </svg>
            </span>
            <div class="detail-info">
                <h1 th:text="${teamName} + ' 팀 통합 주간보고'"></h1>
                <div class="detail-meta">
                    <span class="meta-chip">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                        <span th:text="${#temporals.format(weekStart, 'yyyy-MM-dd')} + ' ~ ' + ${#temporals.format(weekStart.plusDays(6), 'MM-dd')}"></span>
                    </span>
                    <span class="meta-chip">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4-4v2"/><circle cx="9" cy="7" r="4"/></svg>
                        <span th:text="${reportCount} + '명의 보고서 종합'"></span>
                    </span>
                </div>
            </div>
        </div>

        <!-- Copy Buttons -->
        <div class="copy-buttons">
            <button class="btn-sm" onclick="copyTeamReportText()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                텍스트 복사
            </button>
            <button class="btn-sm" onclick="copyTeamReportHtml()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                HTML 복사
            </button>
        </div>

        <div id="rawAggregatedMd" class="hidden" th:text="${aggregatedMd}"></div>

        <!-- Report Content -->
        <div class="section-card">
            <div class="section-card-header">
                <div class="section-icon" style="background:#f3e8ff; color:#805ad5;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                </div>
                <h2>팀 통합 보고서</h2>
            </div>
            <div id="aggregatedContent" class="report-content" th:utext="${aggregatedHtml}"></div>
        </div>

        <!-- Actions -->
        <div class="action-bar">
            <a th:if="${teamReport != null}" th:href="@{/team-report/{id}/pdf(id=${teamReport.id})}" class="btn-secondary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                PDF 다운로드
            </a>
            <a th:href="@{/team-report}" class="btn-primary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                다시 생성
            </a>
            <form th:if="${teamReport != null}" th:id="'deleteForm-' + ${teamReport.id}" th:action="@{/team-report/{id}/delete(id=${teamReport.id})}" method="post" style="display:inline">
                <button type="button" th:onclick="'Modal.open(\'deleteForm-' + ${teamReport.id} + '\')'" class="btn-danger">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
                    삭제
                </button>
            </form>
            <a th:href="@{/dashboard}" class="btn-secondary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                대시보드
            </a>
        </div>
    </div>
</div>

<script>
function copyTeamReportText() {
    var text = document.getElementById('rawAggregatedMd').textContent;
    copyToClipboard(text, '팀 통합보고를 텍스트로 복사했습니다');
}
function copyTeamReportHtml() {
    var html = document.getElementById('aggregatedContent').innerHTML;
    copyHtmlToClipboard(html, '팀 통합보고를 HTML로 복사했습니다');
}
</script>
</body>
</html>
